CASE_INDEX = {"И": 0, "Р": 1, "Д": 2, "В": 3, "Т": 4, "П": 5}

HUNDREDS_WORDS = (
    None,  # 0
    ("сто", "ста", "ста", "сто", "ста", "ста"),  # 1
    ("двести", "двухсот", "двумстам", "двести", "двумястами", "двухстах"),  # 2
    ("триста", "трехсот", "тремстам", "триста", "тремястами", "трехстах"),  # 3
    ("четыреста", "четырехсот", "четыремстам", "четыреста", "четырьмястами", "четырехстах"),  # 4
    ("пятьсот", "пятисот", "пятистам", "пятьсот", "пятьюстами", "пятистах"),  # 5
    ("шестьсот", "шестисот", "шестистам", "шестьсот", "шестьюстами", "шестистах"),  # 6
    ("семьсот", "семисот", "семистам", "семьсот", "семьюстами", "семистах"),  # 7
    ("восемьсот", "восьмисот", "восьмистам", "восемьсот", "восемьюстами", "восьмистах"),  # 8
    ("девятьсот", "девятисот", "девятистам", "девятьсот", "девятьюстами", "девятистах")  # 9
)

TENS_WORDS = (
    None,  # 0
    None,  # 1
    ("двадцать", "двадцати", "двадцати", "двадцать", "двадцатью", "двадцати"),  # 2
    ("тридцать", "тридцати", "тридцати", "тридцать", "тридцатью", "тридцати"),  # 3
    ("сорок", "сорока", "сорока", "сорок", "сорока", "сорока"),  # 4
    ("пятьдесят", "пятидесяти", "пятидесяти", "пятьдесят", "пятьюдесятью", "пятидесяти"),  # 5
    ("шестьдесят", "шестидесяти", "шестидесяти", "шестьдесят", "шестьюдесятью", "шестидесяти"),  # 6
    ("семьдесят", "семидесяти", "семидесяти", "семьдесят", "семьюдесятью", "семидесяти"),  # 7
    ("восемьдесят", "восьмидесяти", "восьмидесяти", "восемьдесят", "восемьюдесятью", "восьмидесяти"),  # 8
    ("девяносто", "девяноста", "девяноста", "девяносто", "девяноста", "девяноста")  # 9
)

UNITS_WORDS = (
    None,  # 0
    {  # 1
        "М": ("один", "одного", "одному", "один", "одним", "одном"),
        "Ж": ("одна", "одной", "одной", "одну", "одной", "одной"),
        "С": ("одно", "одного", "одному", "одно", "одним", "одном")
    },
    {  # 2
        "М": ("два", "двух", "двум", "два", "двумя", "двух"),
        "Ж": ("две", "двух", "двум", "две", "двумя", "двух"),
        "С": ("два", "двух", "двум", "два", "двумя", "двух")
    },
    ("три", "трех", "трем", "три", "тремя", "трех"),  # 3
    ("четыре", "четырех", "четырем", "четыре", "четырьмя", "четырех"),  # 4
    ("пять", "пяти", "пяти", "пять", "пятью", "пяти"),  # 5
    ("шесть", "шести", "шести", "шесть", "шестью", "шести"),  # 6
    ("семь", "семи", "семи", "семь", "семью", "семи"),  # 7
    ("восемь", "восьми", "восьми", "восемь", "восемью", "восьми"),  # 8
    ("девять", "девяти", "девяти", "девять", "девятью", "девяти"),  # 9
    ("десять", "десяти", "десяти", "десять", "десятью", "десяти"),  # 10
    ("одиннадцать", "одиннадцати", "одиннадцати", "одиннадцать", "одиннадцатью", "одиннадцати"),  # 11
    ("двенадцать", "двенадцати", "двенадцати", "двенадцать", "двенадцатью", "двенадцати"),  # 12
    ("тринадцать", "тринадцати", "тринадцати", "тринадцать", "тринадцатью", "тринадцати"),  # 13
    ("четырнадцать", "четырнадцати", "четырнадцати", "четырнадцать", "четырнадцатью", "четырнадцати"),  # 14
    ("пятнадцать", "пятнадцати", "пятнадцати", "пятнадцать", "пятнадцатью", "пятнадцати"),  # 15
    ("шестнадцать", "шестнадцати", "шестнадцати", "шестнадцать", "шестнадцатью", "шестнадцати"),  # 16
    ("семнадцать", "семнадцати", "семнадцати", "семнадцать", "семнадцатью", "семнадцати"),  # 17
    ("восемнадцать", "восемнадцати", "восемнадцати", "восемнадцать", "восемнадцатью", "восемнадцати"),  # 18
    ("девятнадцать", "девятнадцати", "девятнадцати", "девятнадцать", "девятнадцатью", "девятнадцати")  # 19
)

CLASS_FORMS = (
    (  # тысячи (индекс 0)
        ("тысяча", "тысячи", "тысяч"),
        ("тысячи", "тысяч", "тысяч"),
        ("тысяче", "тысячам", "тысячам"),
        ("тысячу", "тысячи", "тысяч"),
        ("тысячей", "тысячами", "тысячами"),
        ("тысяче", "тысячах", "тысячах")
    ),
    (  # миллионы (индекс 1)
        ("миллион", "миллиона", "миллионов"),
        ("миллиона", "миллионов", "миллионов"),
        ("миллиону", "миллионам", "миллионам"),
        ("миллион", "миллиона", "миллионов"),
        ("миллионом", "миллионами", "миллионами"),
        ("миллионе", "миллионах", "миллионах")
    ),
    (  # миллиарды (индекс 2)
        ("миллиард", "миллиарда", "миллиардов"),
        ("миллиарда", "миллиардов", "миллиардов"),
        ("миллиарду", "миллиардам", "миллиардам"),
        ("миллиард", "миллиарда", "миллиардов"),
        ("миллиардом", "миллиардами", "миллиардами"),
        ("миллиарде", "миллиардах", "миллиардах")
    )
)

ZERO_FORMS = ("ноль", "нуля", "нулю", "ноль", "нулем", "нуле")


def sumProp(nSum: int, sGender: str, sCase: str) -> str:
    """Функции преобразования числа в пропись"""
    # Проверка на ноль
    if nSum == 0:
        return ZERO_FORMS[CASE_INDEX[sCase]]

    # Эффективное разбиение на классы
    classes = (
        nSum % 1000,  # единицы
        (nSum // 1000) % 1000,  # тысячи
        (nSum // 1000000) % 1000,  # миллионы
        nSum // 1000000000  # миллиарды
    )
    result_parts = []
    case_idx = CASE_INDEX[sCase] #Падеж

    # Обрабатываем классы от старшего к младшему
    for i in range(3, -1, -1):
        class_value = classes[i]
        if class_value > 0:
            if i == 0:  # единицы
                part = convert_three_digits(class_value, sGender, case_idx)
                if part:
                    result_parts.append(part)
            else:  # тысячи, миллионы, миллиарды
                part = convert_three_digits(class_value, "Ж" if i == 1 else "М", case_idx)
                if part:
                    class_word = get_class_word(class_value, i - 1, case_idx)
                    result_parts.append(f"{part} {class_word}")

    return " ".join(result_parts)


def convert_three_digits(num : int, gender: str, case_idx: int) -> str:
    """Конвертирует число от 1 до 999"""
    if num == 0:
        return ""

    parts = []
    hundreds = num // 100
    tens_units = num % 100

    # Сотни
    if hundreds > 0:
        parts.append(HUNDREDS_WORDS[hundreds][case_idx])

    # Десятки и единицы
    if tens_units > 0:
        if tens_units < 20:
            parts.append(get_units_word(tens_units, gender, case_idx))
        else:
            tens = tens_units // 10
            units = tens_units % 10
            parts.append(TENS_WORDS[tens][case_idx])
            if units > 0:
                parts.append(get_units_word(units, gender, case_idx))

    return " ".join(parts)


def get_units_word(num: int, gender: str, case_idx: int) -> str:
    """Возвращает слово для единиц (1-19)"""
    if num in (1, 2):
        return UNITS_WORDS[num][gender][case_idx]
    return UNITS_WORDS[num][case_idx]


def get_class_word(num: int, class_type: int, case_idx: int) -> str:
    """Определяет форму названия класса"""
    last_two = num % 100

    # Определяем индекс формы (0-единственное, 1-2-4, 2-множественное)
    if 11 <= last_two <= 19:
        form_idx = 2
    else:
        last_digit = num % 10
        form_idx = 0 if last_digit == 1 else (1 if 2 <= last_digit <= 4 else 2)

    return CLASS_FORMS[class_type][case_idx][form_idx]



# Тестирование примеров из задания
if __name__ == "__main__":
    print(sumProp(31, "М", "Р"))
    print(sumProp(22, "С", "Т"))
    print(sumProp(154323, "М", "И"))
    print(sumProp(154323, "М", "Т"))
